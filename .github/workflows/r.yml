# name: R CI

# on:
#   push:

# jobs:
#   run-tests:
#     runs-on: ubuntu-latest
#     steps:
#     - name: Checkout repository
#       uses: actions/checkout@v2

#     - name: Setup R
#       uses: r-lib/actions/setup-r@v2
    
#     # Cache R package dependencies
#     - name: Cache R packages
#       uses: actions/cache@v2
#       with:
#           path: ${{ env.R_LIBS_USER }}
#           key: ${{ runner.os }}-r-${{ hashFiles('**/DESCRIPTION') }}
    
#     # For now we are manually installing dependencies, but we should use description later
#     - name: Install remotes package
#       run: Rscript -e 'install.packages("remotes")'

#     - name: Install dependencies
#       run: Rscript -e 'remotes::install_deps(dependencies = TRUE)'
    
#     # Placeholder for now
#     - name: Run tests
#       run: Rscript -e 'testthat::test_dir("tests/testthat")'
#           # echo "Placeholder for running tests"
#           # Replace the above echo command with actual test execution when ready
#           # testthat::test_dir("tests/testthat")

name: R CI

on:
  push:
    branches:
      - shayla

jobs:
  run-tests:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Setup R
      uses: r-lib/actions/setup-r@v2

    - name: Cache R packages
      uses: actions/cache@v2
      with:
        path: ${{ env.R_LIBS_USER }}
        key: ${{ runner.os }}-r-${{ hashFiles('**/DESCRIPTION') }}
        restore-keys: ${{ runner.os }}-r-

    - name: Install dependencies
      run: |
        Rscript -e 'install.packages("remotes")'
        Rscript -e 'remotes::install_deps(dependencies = TRUE, repos = "http://cran.rstudio.com")'
        Rscript -e 'install.packages("httr", repos = "http://cran.rstudio.com")' # Explicitly install httr
        Rscript -e 'install.packages("ggplot2", repos = "http://cran.rstudio.com")' 
        Rscript -e 'install.packages("jsonlite", repos = "http://cran.rstudio.com")' 
        Rscript -e 'install.packages("tidyverse", repos = "http://cran.rstudio.com")' 

    - name: Install the footwrap package
      run: R CMD INSTALL footwrap

    - name: Run tests
      run: Rscript -e 'testthat::test_dir("footwrap/tests/testthat")'
